{% extends 'admin_base.html' %}

{% block title %}Detalhes do Veículo: {{ veiculo.placa }}{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>Perfil do Veículo: {{ veiculo.modelo }} ({{ veiculo.placa }})</h3>
        <div>
            <a href="{% url 'lista_veiculos' %}" class="btn btn-secondary">Voltar para a Frota</a>
            <a href="{% url 'editar_veiculo' veiculo.pk %}" class="btn btn-primary">Editar Veículo</a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-5">
            <div class="card mb-4">
                <div class="card-header">Informações Gerais</div>
                <div class="card-body">
                    <p><strong>Placa:</strong> {{ veiculo.placa }}</p>
                    <p><strong>Modelo:</strong> {{ veiculo.modelo }}</p>
                    <p><strong>Quilometragem:</strong> {{ veiculo.km }} km</p>
                    <p><strong>Última Manutenção:</strong> {{ veiculo.ultimaManutencao|date:"d/m/Y"|default:"Nunca realizada" }}</p>
                    {% if veiculo.precisa_manutencao %}
                        <p class="text-danger"><i class="fas fa-exclamation-triangle"></i> Manutenção preventiva recomendada!</p>
                    {% endif %}
                </div>
            </div>

            <div class="card">
                <div class="card-header">Status Atual</div>
                <div class="card-body">
                    {% if veiculo.status == 'DISPONIVEL' %}
                        <div class="alert alert-success mb-0">
                            <h5 class="alert-heading"><i class="fas fa-check-circle mr-2"></i>Disponível</h5>
                            <p class="mb-0">Este veículo está livre para ser alocado a novas rotas.</p>
                        </div>
                    {% elif veiculo.status == 'EM_ROTA' or veiculo.status == 'EM_ENTREGA' %}
                        <div class="alert alert-primary mb-0">
                            <h5 class="alert-heading"><i class="fas fa-route mr-2"></i>Em Rota</h5>
                            {% if rota_ativa %}
                                <p>Atualmente na <strong>Rota #{{ rota_ativa.id }}</strong>.</p>
                                <p class="mb-0"><strong>Motorista:</strong> {{ rota_ativa.motorista.nome }}</p>
                            {% endif %}
                        </div>
                    {% elif veiculo.status == 'EM_MANUTENCAO' %}
                        <div class="alert alert-warning mb-0">
                             <h5 class="alert-heading"><i class="fas fa-tools mr-2"></i>Em Manutenção</h5>
                             <p class="mb-0">Este veículo está indisponível para rotas.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#rotas">Histórico de Rotas</a></li>
                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#manutencoes">Manutenções</a></li>
                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#abastecimentos">Abastecimentos</a></li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="rotas">
                            {% if rotas_concluidas %}
                                <table class="table table-sm">
                                    <tbody>
                                    {% for rota in rotas_concluidas %}
                                        <tr>
                                            <td>Rota #{{ rota.id }}</td>
                                            <td>Concluída em {{ rota.data_fim_real|date:"d/m/Y" }}</td>
                                            <td>Motorista: {{ rota.motorista.nome }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}<p class="text-muted">Nenhum histórico de rotas.</p>{% endif %}
                        </div>
                        <div class="tab-pane fade" id="manutencoes">
                            {% if historico_manutencao %}
                                <table class="table table-sm">
                                     <tbody>
                                    {% for manutencao in historico_manutencao %}
                                        <tr>
                                            <td>{{ manutencao.data|date:"d/m/Y" }}</td>
                                            <td>{{ manutencao.get_tipo_display }}</td>
                                            <td>R$ {{ manutencao.custo }}</td>
                                        </tr>
                                    {% endfor %}
                                     </tbody>
                                </table>
                            {% else %}<p class="text-muted">Nenhum histórico de manutenção.</p>{% endif %}
                        </div>
                        <div class="tab-pane fade" id="abastecimentos">
                            {% if historico_abastecimento %}
                                <table class="table table-sm">
                                     <tbody>
                                    {% for item in historico_abastecimento %}
                                        <tr>
                                            <td>{{ item.dataAbastecimento|date:"d/m/Y" }}</td>
                                            <td>{{ item.litros }} L</td>
                                            <td>R$ {{ item.custo }}</td>
                                        </tr>
                                    {% endfor %}
                                     </tbody>
                                </table>
                            {% else %}<p class="text-muted">Nenhum histórico de abastecimento.</p>{% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}